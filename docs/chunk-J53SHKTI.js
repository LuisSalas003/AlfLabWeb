import{Ea as E,P as g,b as l,c as d,d as i,ja as h,la as m,na as f,pa as p,qa as D,ta as y,ya as n,za as c}from"./chunk-7DSZXF6B.js";var w=class u{constructor(r,e,o){this.auth=r;this.firestore=e;this.router=o;this.user$=new l(s=>{let t=f(this.auth,a=>{s.next(a)});return()=>t()})}user$;async login(r,e){try{let o=await p(this.auth,r,e);try{let s=await c(n(this.firestore,"usuarios",o.user.uid));if(s.exists()){let t=s.data();localStorage.setItem("userData",JSON.stringify(t)),console.log("Usuario logueado:",t)}}catch(s){console.warn("No se pudieron obtener datos adicionales de Firestore:",s)}return setTimeout(()=>{this.router.navigate(["/main"])},100),{success:!0}}catch(o){return console.error("Error en login:",o),console.error("C\xF3digo de error:",o.code),{success:!1,error:this.getErrorMessage(o.code)}}}async register(r,e,o,s="usuario"){try{let t=await m(this.auth,r,e),a={uid:t.user.uid,email:r,username:o||r.split("@")[0],rol:s,fechaCreacion:new Date};try{await E(n(this.firestore,"usuarios",t.user.uid),a),localStorage.setItem("userData",JSON.stringify(a)),console.log("Usuario registrado:",a)}catch(v){console.warn("Error al guardar datos en Firestore:",v)}return setTimeout(()=>{this.router.navigate(["/main"])},100),{success:!0}}catch(t){return console.error("Error en registro:",t),console.error("C\xF3digo de error:",t.code),{success:!1,error:this.getErrorMessage(t.code)}}}async logout(){try{await D(this.auth),localStorage.removeItem("userData"),this.router.navigate(["/login"])}catch(r){console.error("Error al cerrar sesi\xF3n:",r)}}getCurrentUser(){return this.auth.currentUser}getUserData(){let r=localStorage.getItem("userData");return r?JSON.parse(r):null}async getUserDataFromFirestore(r){try{let e=await c(n(this.firestore,"usuarios",r));return e.exists()?e.data():null}catch(e){return console.error("Error al obtener datos del usuario:",e),null}}isAuthenticated(){return this.auth.currentUser!==null}getErrorMessage(r){return{"auth/invalid-email":"El email no es v\xE1lido","auth/user-disabled":"El usuario ha sido deshabilitado","auth/user-not-found":"Email o contrase\xF1a incorrectos","auth/wrong-password":"Email o contrase\xF1a incorrectos","auth/email-already-in-use":"El email ya est\xE1 en uso","auth/weak-password":"La contrase\xF1a debe tener al menos 6 caracteres","auth/invalid-credential":"Email o contrase\xF1a incorrectos","auth/too-many-requests":"Demasiados intentos fallidos. Intenta m\xE1s tarde","auth/network-request-failed":"Error de conexi\xF3n. Verifica tu internet","auth/operation-not-allowed":"Operaci\xF3n no permitida","auth/requires-recent-login":"Por seguridad, vuelve a iniciar sesi\xF3n"}[r]||"Email o contrase\xF1a incorrectos"}static \u0275fac=function(e){return new(e||u)(i(h),i(y),i(g))};static \u0275prov=d({token:u,factory:u.\u0275fac,providedIn:"root"})};export{w as a};
