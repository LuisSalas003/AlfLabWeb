import{Aa as u,Ba as l,Ga as w,R as h,b as i,c as d,d as g,e as n,la as m,na as f,pa as p,ra as D,sa as y,va as E}from"./chunk-GLG6NGVP.js";var v=class c{constructor(r,e,o){this.auth=r;this.firestore=e;this.router=o;this.user$=new d(s=>{let t=p(this.auth,a=>{s.next(a)});return()=>t()})}user$;login(r,e){return i(this,null,function*(){try{let o=yield D(this.auth,r,e);try{let s=yield l(u(this.firestore,"usuarios",o.user.uid));if(s.exists()){let t=s.data();localStorage.setItem("userData",JSON.stringify(t)),console.log("Usuario logueado:",t)}}catch(s){console.warn("No se pudieron obtener datos adicionales de Firestore:",s)}return setTimeout(()=>{this.router.navigate(["/main"])},100),{success:!0}}catch(o){return console.error("Error en login:",o),console.error("C\xF3digo de error:",o.code),{success:!1,error:this.getErrorMessage(o.code)}}})}register(r,e,o,s="usuario"){return i(this,null,function*(){try{let t=yield f(this.auth,r,e),a={uid:t.user.uid,email:r,username:o||r.split("@")[0],rol:s,fechaCreacion:new Date};try{yield w(u(this.firestore,"usuarios",t.user.uid),a),localStorage.setItem("userData",JSON.stringify(a)),console.log("Usuario registrado:",a)}catch(U){console.warn("Error al guardar datos en Firestore:",U)}return setTimeout(()=>{this.router.navigate(["/main"])},100),{success:!0}}catch(t){return console.error("Error en registro:",t),console.error("C\xF3digo de error:",t.code),{success:!1,error:this.getErrorMessage(t.code)}}})}logout(){return i(this,null,function*(){try{yield y(this.auth),localStorage.removeItem("userData"),this.router.navigate(["/login"])}catch(r){console.error("Error al cerrar sesi\xF3n:",r)}})}getCurrentUser(){return this.auth.currentUser}getUserData(){let r=localStorage.getItem("userData");return r?JSON.parse(r):null}getUserDataFromFirestore(r){return i(this,null,function*(){try{let e=yield l(u(this.firestore,"usuarios",r));return e.exists()?e.data():null}catch(e){return console.error("Error al obtener datos del usuario:",e),null}})}isAuthenticated(){return this.auth.currentUser!==null}getErrorMessage(r){return{"auth/invalid-email":"El email no es v\xE1lido","auth/user-disabled":"El usuario ha sido deshabilitado","auth/user-not-found":"Email o contrase\xF1a incorrectos","auth/wrong-password":"Email o contrase\xF1a incorrectos","auth/email-already-in-use":"El email ya est\xE1 en uso","auth/weak-password":"La contrase\xF1a debe tener al menos 6 caracteres","auth/invalid-credential":"Email o contrase\xF1a incorrectos","auth/too-many-requests":"Demasiados intentos fallidos. Intenta m\xE1s tarde","auth/network-request-failed":"Error de conexi\xF3n. Verifica tu internet","auth/operation-not-allowed":"Operaci\xF3n no permitida","auth/requires-recent-login":"Por seguridad, vuelve a iniciar sesi\xF3n"}[r]||"Email o contrase\xF1a incorrectos"}static \u0275fac=function(e){return new(e||c)(n(m),n(E),n(h))};static \u0275prov=g({token:c,factory:c.\u0275fac,providedIn:"root"})};export{v as a};
