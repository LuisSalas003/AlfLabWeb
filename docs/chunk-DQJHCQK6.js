import{A as w,B as C,C as M,I,L as F,P as N,Q as z,R as A,S as V,T,U as j,Y as W,Z as Y,aa as q,b as v,c as E,ca as R,d as g,ea as B,f as p,fa as J,g as m,ga as G,h as f,ha as H,j as c,k as P,l as O,ma as x,n as S,na as y,o as D,p as h,q as i,r as a,sa as K,t as k,u,v as b,x as s,y as L,z as U}from"./chunk-PPCBLEWP.js";var _=class l{constructor(e,r,t){this.auth=e;this.firestore=r;this.router=t;this.user$=new v(n=>{let o=B(this.auth,d=>{n.next(d)});return()=>o()})}user$;async login(e,r){try{let t=await J(this.auth,e,r);try{let n=await y(x(this.firestore,"usuarios",t.user.uid));if(n.exists()){let o=n.data();localStorage.setItem("userData",JSON.stringify(o)),console.log("Usuario logueado:",o)}}catch(n){console.warn("No se pudieron obtener datos adicionales de Firestore:",n)}return setTimeout(()=>{this.router.navigate(["/main"])},100),{success:!0}}catch(t){return console.error("Error en login:",t),console.error("C\xF3digo de error:",t.code),{success:!1,error:this.getErrorMessage(t.code)}}}async register(e,r,t,n="usuario"){try{let o=await R(this.auth,e,r),d={uid:o.user.uid,email:e,username:t||e.split("@")[0],rol:n,fechaCreacion:new Date};try{await K(x(this.firestore,"usuarios",o.user.uid),d),localStorage.setItem("userData",JSON.stringify(d)),console.log("Usuario registrado:",d)}catch(X){console.warn("Error al guardar datos en Firestore:",X)}return setTimeout(()=>{this.router.navigate(["/main"])},100),{success:!0}}catch(o){return console.error("Error en registro:",o),console.error("C\xF3digo de error:",o.code),{success:!1,error:this.getErrorMessage(o.code)}}}async logout(){try{await G(this.auth),localStorage.removeItem("userData"),this.router.navigate(["/login"])}catch(e){console.error("Error al cerrar sesi\xF3n:",e)}}getCurrentUser(){return this.auth.currentUser}getUserData(){let e=localStorage.getItem("userData");return e?JSON.parse(e):null}async getUserDataFromFirestore(e){try{let r=await y(x(this.firestore,"usuarios",e));return r.exists()?r.data():null}catch(r){return console.error("Error al obtener datos del usuario:",r),null}}isAuthenticated(){return this.auth.currentUser!==null}getErrorMessage(e){return{"auth/invalid-email":"El email no es v\xE1lido","auth/user-disabled":"El usuario ha sido deshabilitado","auth/user-not-found":"Email o contrase\xF1a incorrectos","auth/wrong-password":"Email o contrase\xF1a incorrectos","auth/email-already-in-use":"El email ya est\xE1 en uso","auth/weak-password":"La contrase\xF1a debe tener al menos 6 caracteres","auth/invalid-credential":"Email o contrase\xF1a incorrectos","auth/too-many-requests":"Demasiados intentos fallidos. Intenta m\xE1s tarde","auth/network-request-failed":"Error de conexi\xF3n. Verifica tu internet","auth/operation-not-allowed":"Operaci\xF3n no permitida","auth/requires-recent-login":"Por seguridad, vuelve a iniciar sesi\xF3n"}[e]||"Email o contrase\xF1a incorrectos"}static \u0275fac=function(r){return new(r||l)(g(q),g(H),g(F))};static \u0275prov=E({token:l,factory:l.\u0275fac,providedIn:"root"})};function ee(l,e){if(l&1){let r=k();i(0,"div",10),u("click",function(){p(r);let n=b();return m(n.closeErrorModal())}),i(1,"div",11),u("click",function(n){return p(r),m(n.stopPropagation())}),i(2,"div",12),s(3,"\u274C"),a(),i(4,"h3"),s(5,"Error de inicio de sesi\xF3n"),a(),i(6,"p"),s(7),a(),i(8,"button",13),u("click",function(){p(r);let n=b();return m(n.closeErrorModal())}),s(9,"Aceptar"),a()()()}if(l&2){let r=b();c(7),L(r.errorMessage())}}var Q=class l{constructor(e){this.authService=e}email="";password="";isLoading=f(!1);showErrorModal=f(!1);errorMessage=f("");async login(){if(!this.email||!this.password){this.showError("Por favor ingresa email y contrase\xF1a");return}this.isLoading.set(!0);try{console.log("Intentando login...");let e=await this.authService.login(this.email,this.password);e.success||(console.log("Mostrando error:",e.error),this.showError(e.error||"Error al iniciar sesi\xF3n"))}catch(e){console.error("Error inesperado:",e),this.showError("Error inesperado. Por favor intenta de nuevo.")}finally{this.isLoading.set(!1)}}showError(e){console.log("showError llamado con:",e),this.errorMessage.set(e),this.showErrorModal.set(!0),console.log("showErrorModal:",this.showErrorModal())}closeErrorModal(){this.showErrorModal.set(!1),this.errorMessage.set("")}static \u0275fac=function(r){return new(r||l)(P(_))};static \u0275cmp=O({type:l,selectors:[["app-login"]],decls:18,vars:7,consts:[[1,"login-wrapper"],[1,"login-box"],[3,"ngSubmit"],[1,"input-group"],[1,"icon"],["type","email","placeholder","Email","name","email","required","","autocomplete","email",3,"ngModelChange","ngModel","disabled"],["type","password","placeholder","Password","name","password","required","","autocomplete","current-password",3,"ngModelChange","ngModel","disabled"],["href","#","type","button",1,"forgot-link"],["type","submit",3,"disabled"],[1,"modal-overlay"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-icon"],[1,"modal-button",3,"click"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"h2"),s(3,"Bienvenido"),a(),i(4,"form",2),u("ngSubmit",function(){return t.login()}),i(5,"div",3)(6,"span",4),s(7,"\u{1F4E7}"),a(),i(8,"input",5),M("ngModelChange",function(o){return C(t.email,o)||(t.email=o),o}),a()(),i(9,"div",3)(10,"span",4),s(11,"\u{1F512}"),a(),i(12,"input",6),M("ngModelChange",function(o){return C(t.password,o)||(t.password=o),o}),a()(),i(13,"a",7),s(14,"Olvid\xE9 mi contrase\xF1a"),a(),i(15,"button",8),s(16),a()()(),S(17,ee,10,1,"div",9),a()),r&2&&(c(8),w("ngModel",t.email),h("disabled",t.isLoading()),c(4),w("ngModel",t.password),h("disabled",t.isLoading()),c(3),h("disabled",t.isLoading()),c(),U(" ",t.isLoading()?"Iniciando sesi\xF3n...":"Iniciar Sesi\xF3n"," "),c(),D(t.showErrorModal()?17:-1))},dependencies:[I,Y,j,N,z,A,W,T,V],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}.login-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.login-box[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2874a6,#1f618d);padding:50px 60px;border-radius:20px;box-shadow:0 15px 50px #00000080;width:100%;max-width:450px}h2[_ngcontent-%COMP%]{color:#fff;text-align:center;margin-bottom:40px;font-size:36px;font-weight:600;letter-spacing:1px}.input-group[_ngcontent-%COMP%]{position:relative;margin-bottom:25px}.input-group[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{position:absolute;left:15px;top:50%;transform:translateY(-50%);font-size:20px;z-index:1}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:15px 15px 15px 50px;border:none;border-radius:10px;background:#ffffff26;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);color:#fff;font-size:16px;outline:none;transition:all .3s ease}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#ffffffb3}form[_ngcontent-%COMP%]{width:100%}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{background:#ffffff40;box-shadow:0 0 15px #fff3}.forgot-link[_ngcontent-%COMP%]{display:block;text-align:center;color:#fff;text-decoration:underline;margin:20px 0;font-size:14px;cursor:pointer;transition:opacity .3s ease}.forgot-link[_ngcontent-%COMP%]:hover{opacity:.8}button[_ngcontent-%COMP%]{width:100%;padding:15px;background:linear-gradient(135deg,#3498db,#2980b9);color:#fff;border:none;border-radius:10px;font-size:18px;font-weight:600;cursor:pointer;transition:all .3s ease;box-shadow:0 5px 15px #3498db4d}button[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#2980b9,#21618c);transform:translateY(-2px);box-shadow:0 8px 20px #3498db66}button[_ngcontent-%COMP%]:active{transform:translateY(0)}button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none!important}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;justify-content:center;align-items:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .3s ease}.modal-content[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2874a6,#1f618d);padding:40px;border-radius:20px;box-shadow:0 20px 60px #00000080;max-width:400px;width:90%;text-align:center;animation:_ngcontent-%COMP%_slideUp .3s ease}.modal-icon[_ngcontent-%COMP%]{font-size:60px;margin-bottom:20px;animation:_ngcontent-%COMP%_bounce .5s ease}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-size:24px;margin-bottom:15px;font-weight:600}.modal-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#ffffffe6;font-size:16px;margin-bottom:25px;line-height:1.5}.modal-button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff;border:none;padding:12px 40px;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;box-shadow:0 5px 15px #e74c3c4d;width:auto}.modal-button[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#c0392b,#a93226);transform:translateY(-2px);box-shadow:0 8px 20px #e74c3c66}.modal-button[_ngcontent-%COMP%]:active{transform:translateY(0)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(50px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:scale(1)}50%{transform:scale(1.1)}}"]})};export{Q as LoginComponent};
